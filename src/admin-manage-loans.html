<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Loans | GBLDC Admin</title>
  <link rel="stylesheet" href="output.css" />
  <link rel="icon" type="image/png" href="path/images/logocoop-removebg-preview 2.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <!-- ✅ DataTables Core & Responsive CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased min-h-screen">
  <!-- Header Section -->
  <header class="bg-white shadow-md fixed left-0 top-0 z-50 w-full">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-3">
      <div class="flex items-center space-x-4">
        <a href="admin-page.html">
          <img src="path/images/logocoop-removebg-preview 2.png" alt="GBLDC Logo" class="w-12 h-12 object-cover" />
        </a>
        <h1 class="text-lg md:text-xl font-semibold text-green-800">GBLDC Admin - Manage Loans</h1>
      </div>
      <div class="flex items-center gap-4">
        <span class="md:inline text-gray-700">Admin</span>
        <img src="path/images/logocoop-removebg-preview 2.png" alt="Admin Avatar" class="w-10 h-10 rounded-full border-2 border-green-600 object-cover" />
      </div>
    </div>
  </header>

  <main class="pt-28 pb-12 px-4 max-w-7xl mx-auto">
    <!-- Title -->
     <div class="flex items-center mb-4">
      <button onclick="window.history.back()" class="inline-flex items-center px-3 py-1.5 rounded bg-green-100 text-green-800 hover:bg-green-200 transition-colors focus:outline-none focus:ring-2 focus:ring-green-400 shadow-sm mr-3">
        <i class="fa fa-arrow-left mr-2"></i> Back
      </button>
    </div>
      <div class="mb-6">
        <h2 class="text-2xl font-bold text-teal-900 mb-1">Manage Loan Application</h2>
        <p class="text-gray-700">Review, approve, or reject loan applications from members.</p>
      </div>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-xl shadow p-8">
      <h3 class="text-2xl font-bold text-green-800 mb-6 flex items-center gap-2">
        Loan Applications
      </h3>
      <div class="overflow-x-auto">
        <table id="loanTable" class="display responsive nowrap w-full text-sm border border-green-100 rounded-lg">
          <thead>
            <tr class="bg-green-100 text-green-900">
              <th>Application #</th>
              <th>Applicant</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Date Applied</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Sample Rows -->
            <tr class="even:bg-green-50 hover:bg-green-100 transition-colors">
              <td title="1001">1001</td>
              <td title="Juan Dela Cruz">Juan Dela Cruz</td>
              <td title="Personal Loan">Personal Loan</td>
              <td title="₱50,000">₱50,000</td>
              <td>
                <span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded font-semibold inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  Pending
                </span>
              </td>
              <td>2024-06-01</td>
              <td><button class="view-loan-btn px-3 py-1 rounded bg-green-50 text-green-700 border border-green-200 hover:bg-green-200 hover:text-green-900 focus:outline-none focus:ring-2 focus:ring-green-400 transition-all shadow-sm"
                data-applicant="Juan Dela Cruz"
                data-type="Personal Loan"
                data-amount="₱50,000"
                data-status="Pending"
                data-date="2024-06-01"
                data-id="1001"
                data-step1='{"Full Name":"Juan Dela Cruz","Birthday":"1990-01-01","Gender":"Male","Civil Status":"Single"}'
                data-step2='{"Address":"123 Main St, Manila","Contact":"09171234567","Email":"juan@email.com"}'
                data-step3='{"Employer":"ABC Corp","Position":"Staff","Monthly Income":"₱20,000"}'
                data-step4='{"Loan Purpose":"Medical","Collateral":"None"}'
                title="View full application details"
              >View Details</button></td>
            </tr>
            <tr class="even:bg-green-50 hover:bg-green-100 transition-colors">
              <td title="1002">1002</td>
              <td title="Maria Santos">Maria Santos</td>
              <td title="Motorcycle Loan">Motorcycle Loan</td>
              <td title="₱80,000">₱80,000</td>
              <td>
                <span class="bg-green-200 text-green-800 px-2 py-1 rounded font-semibold inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2l4-4m5 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                  Approved
                </span>
              </td>
              <td>2024-05-20</td>
              <td><button class="view-loan-btn px-3 py-1 rounded bg-green-50 text-green-700 border border-green-200 hover:bg-green-200 hover:text-green-900 focus:outline-none focus:ring-2 focus:ring-green-400 transition-all shadow-sm"
                data-applicant="Maria Santos"
                data-type="Motorcycle Loan"
                data-amount="₱80,000"
                data-status="Approved"
                data-date="2024-05-20"
                data-id="1002"
                data-step1='{"Full Name":"Maria Santos","Birthday":"1988-05-05","Gender":"Female","Civil Status":"Married"}'
                data-step2='{"Address":"456 Rizal Ave, Quezon City","Contact":"09181234567","Email":"maria@email.com"}'
                data-step3='{"Employer":"XYZ Inc","Position":"Manager","Monthly Income":"₱35,000"}'
                data-step4='{"Loan Purpose":"Motorcycle Purchase","Collateral":"Motorcycle"}'
                title="View full application details"
              >View Details</button></td>
            </tr>
            <tr class="even:bg-green-50 hover:bg-green-100 transition-colors">
              <td title="1003">1003</td>
              <td title="Pedro Reyes">Pedro Reyes</td>
              <td title="Sunergy Loan">Sunergy Loan</td>
              <td title="₱120,000">₱120,000</td>
              <td>
                <span class="bg-red-200 text-red-800 px-2 py-1 rounded font-semibold inline-flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                  Rejected
                </span>
              </td>
              <td>2024-05-10</td>
              <td><button class="view-loan-btn px-3 py-1 rounded bg-green-50 text-green-700 border border-green-200 hover:bg-green-200 hover:text-green-900 focus:outline-none focus:ring-2 focus:ring-green-400 transition-all shadow-sm inline-flex items-center gap-1"
                data-applicant="Pedro Reyes"
                data-type="Sunergy Loan"
                data-amount="₱120,000"
                data-status="Rejected"
                data-date="2024-05-10"
                data-id="1003"
                data-step1='{"Full Name":"Pedro Reyes","Birthday":"1985-09-09","Gender":"Male","Civil Status":"Single"}'
                data-step2='{"Address":"789 Mabini St, Makati","Contact":"09192223333","Email":"pedro@email.com"}'
                data-step3='{"Employer":"Sunergy PH","Position":"Technician","Monthly Income":"₱25,000"}'
                data-step4='{"Loan Purpose":"Solar Panel","Collateral":"House"}'
                title="View full application details"
              >
                View Details
              </button></td>
            </tr>
            <tr class="even:bg-green-50 hover:bg-green-100 transition-colors">
              <td title="1004">1004</td>
              <td title="Ana Cruz">Ana Cruz</td>
              <td title="Health Loan">Health Loan</td>
              <td title="₱30,000">₱30,000</td>
              <td><span class="bg-green-200 text-green-800 px-2 py-1 rounded font-semibold">Approved</span></td>
              <td>2024-04-15</td>
              <td><button class="view-loan-btn px-3 py-1 rounded bg-green-50 text-green-700 border border-green-200 hover:bg-green-200 hover:text-green-900 focus:outline-none focus:ring-2 focus:ring-green-400 transition-all shadow-sm"
                data-applicant="Ana Cruz"
                data-type="Health Loan"
                data-amount="₱30,000"
                data-status="Approved"
                data-date="2024-04-15"
                data-id="1004"
                data-step1='{"Full Name":"Ana Cruz","Birthday":"1992-02-09", "Gender":"Female","Civil Status":"Single"}'
                data-step2='{"Address":"123 Jones Ave, Manila","Contact":"09212345678","Email":"ana@gmail.com"}'
                data-step3='{"Employer":"HealthPlus","Position":"Nurse","Monthly Income":"₱28,000"}'
                data-step4='{"Loan Purpose":"Medical Expenses","Collateral":"None"}'
                title="View full application details"
              >View Details</button></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
  <script>
    $(document).ready(function () {
      // Setup - add a select to each header for filtering
      $('#loanTable thead tr').clone(true).appendTo('#loanTable thead');
      $('#loanTable thead tr:eq(1) th').each(function (i) {
        if (i === 2 || i === 4) { // Type or Status column
          var select = $('<select class="border rounded px-1 py-0.5 text-xs"><option value="">All</option></select>')
            .appendTo($(this).empty())
            .on('change', function () {
              var val = $.fn.dataTable.util.escapeRegex($(this).val());
              table.column(i).search(val ? '^' + val + '$' : '', true, false).draw();
            });
          $('#loanTable tbody tr').each(function () {
            var cellText = $('td', this).eq(i).text().trim();
            if (select.find('option[value="' + cellText + '"]').length === 0) {
              select.append('<option value="' + cellText + '">' + cellText + '</option>');
            }
          });
        } else {
          $(this).html('');
        }
      });
      const table = $('#loanTable').DataTable({
        responsive: true,
        orderCellsTop: true,
        fixedHeader: true,
        language: {
          search: "🔍 Search:",
          lengthMenu: "Show _MENU_ entries",
          info: "Showing _START_ to _END_ of _TOTAL_ loans",
          infoEmpty: "No loans found",
          zeroRecords: "No matching loans found"
        }
      });
    });

    // Improved modal rendering with icons and better layout
    function renderStep(title, data, icon) {
      let html = `<div style=\"margin-bottom:10px;\"><span style=\"font-weight:bold;display:inline-flex;align-items:center;gap:6px;\">${icon || ''}${title}</span><ul style=\"margin:4px 0 0 18px;padding:0;\">`;
      for (const key in data) {
        html += `<li style=\"margin-bottom:2px;\"><strong>${key}:</strong> ${data[key]}</li>`;
      }
      html += '</ul></div>';
      return html;
    }

    const icons = [
      '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>',
      '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4M8 3v4"/></svg>',
      '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H7a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/></svg>',
      '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 3v4M8 3v4"/></svg>'
    ];

    document.querySelectorAll('.view-loan-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const step1 = JSON.parse(this.dataset.step1 || '{}');
        const step2 = JSON.parse(this.dataset.step2 || '{}');
        const step3 = JSON.parse(this.dataset.step3 || '{}');
        const step4 = JSON.parse(this.dataset.step4 || '{}');

        Swal.fire({
          title: '<span style="font-size:1.2em;font-weight:bold;">Loan Application Details</span>',
          html: `
            <div class="text-left" style="max-height:400px;overflow:auto;">
              ${renderStep('Step 1: Personal Information', step1, icons[0])}
              ${renderStep('Step 2: Contact Information', step2, icons[1])}
              ${renderStep('Step 3: Employment Information', step3, icons[2])}
              ${renderStep('Step 4: Loan Details', step4, icons[3])}
            </div>
          `,
          showDenyButton: true,
          showCancelButton: true,
            confirmButtonText: '<span style="font-weight:semi-bold;">Approve</span>',
            denyButtonText: '<span style="font-weight:semi-bold;">Reject</span>',
            cancelButtonText: 'Close',
            showDenyButton: true,
            showCancelButton: true,
            buttonsStyling: false,
            customClass: {
            actions: 'flex gap-3 justify-center',
            popup: 'rounded-xl',
            confirmButton: 'bg-green-600 text-white px-4 py-2 rounded shadow hover:bg-green-700',
            denyButton: 'bg-red-500 text-white px-4 py-2 rounded shadow hover:bg-red-600',
            cancelButton: 'bg-gray-200 text-gray-700 px-4 py-2 rounded shadow hover:bg-gray-300'
            },
          buttonsStyling: false
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({
              title: 'Approved!',
              icon: 'success',
              timer: 1200,
              showConfirmButton: false
            });
          } else if (result.isDenied) {
            Swal.fire({
              title: 'Rejected!',
              icon: 'error',
              timer: 1200,
              showConfirmButton: false
            });
          }
        });
      });
    });
  </script>
</body>
</html>
