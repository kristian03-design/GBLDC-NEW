<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Loans | GBLDC Admin</title>
  <link rel="stylesheet" href="output.css" />
  <link rel="icon" type="image/png" href="path/images/logocoop-removebg-preview 2.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <!-- ✅ DataTables Core & Responsive CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.dataTables.min.css">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>
<body class="bg-gray-50 text-gray-800 font-sans antialiased min-h-screen">
  <!-- Header Section -->
  <header class="bg-white shadow-md fixed left-0 top-0 z-50 w-full">
    <div class="max-w-7xl mx-auto flex justify-between items-center px-4 py-3">
      <div class="flex items-center space-x-4">
        <a href="admin-page.html">
          <img src="path/images/logocoop-removebg-preview 2.png" alt="GBLDC Logo" class="w-12 h-12 object-cover" />
        </a>
        <h1 class="text-lg md:text-xl font-semibold text-green-800">GBLDC Admin - Manage Loans</h1>
      </div>
      <div class="flex items-center gap-4">
        <span class="md:inline text-gray-700">Admin</span>
        <img src="path/images/admin-avatar.png" alt="Admin Avatar" class="w-10 h-10 rounded-full border-2 border-green-600 object-cover" />
      </div>
    </div>
  </header>

  <main class="pt-28 pb-12 px-4 max-w-7xl mx-auto">
    <!-- Title -->
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-green-800">Manage Loan Applications</h2>
      <p class="text-gray-700">Review, approve, or reject loan applications from members.</p>
    </div>

    <!-- Table -->
    <div class="bg-white rounded-xl shadow p-6">
      <h3 class="text-lg font-semibold text-green-700 mb-4">Loan Applications</h3>
      <div class="overflow-x-auto">
        <table id="loanTable" class="display responsive nowrap w-full text-sm">
          <thead>
            <tr class="bg-green-100 text-green-900">
              <th>Application Number</th>
              <th>Applicant</th>
              <th>Type</th>
              <th>Amount</th>
              <th>Status</th>
              <th>Date Applied</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Sample Rows -->
            <tr>
              <td>1001</td>
              <td>Juan Dela Cruz</td>
              <td>Personal Loan</td>
              <td>₱50,000</td>
              <td><span class="bg-yellow-200 text-yellow-800 px-2 py-1 rounded">Pending</span></td>
              <td>2024-06-01</td>
              <td><button class="text-green-600 hover:underline view-loan-btn"
                data-applicant="Juan Dela Cruz"
                data-type="Personal Loan"
                data-amount="₱50,000"
                data-status="Pending"
                data-date="2024-06-01"
                data-id="1001"
                data-step1='{"Full Name":"Juan Dela Cruz","Birthday":"1990-01-01","Gender":"Male","Civil Status":"Single"}'
                data-step2='{"Address":"123 Main St, Manila","Contact":"09171234567","Email":"juan@email.com"}'
                data-step3='{"Employer":"ABC Corp","Position":"Staff","Monthly Income":"₱20,000"}'
                data-step4='{"Loan Purpose":"Medical","Collateral":"None"}'
              >View Details</button></td>
            </tr>
            <tr>
              <td>1002</td>
              <td>Maria Santos</td>
              <td>Motorcycle Loan</td>
              <td>₱80,000</td>
              <td><span class="bg-green-200 text-green-800 px-2 py-1 rounded">Approved</span></td>
              <td>2024-05-20</td>
              <td><button class="text-green-600 hover:underline view-loan-btn"
                data-applicant="Maria Santos"
                data-type="Motorcycle Loan"
                data-amount="₱80,000"
                data-status="Approved"
                data-date="2024-05-20"
                data-id="1002"
                data-step1='{"Full Name":"Maria Santos","Birthday":"1988-05-05","Gender":"Female","Civil Status":"Married"}'
                data-step2='{"Address":"456 Rizal Ave, Quezon City","Contact":"09181234567","Email":"maria@email.com"}'
                data-step3='{"Employer":"XYZ Inc","Position":"Manager","Monthly Income":"₱35,000"}'
                data-step4='{"Loan Purpose":"Motorcycle Purchase","Collateral":"Motorcycle"}'
              >View Details</button></td>
            </tr>
            <tr>
              <td>1003</td>
              <td>Pedro Reyes</td>
              <td>Sunergy Loan</td>
              <td>₱120,000</td>
              <td><span class="bg-red-200 text-red-800 px-2 py-1 rounded">Rejected</span></td>
              <td>2024-05-10</td>
              <td><button class="text-green-600 hover:underline view-loan-btn"
                data-applicant="Pedro Reyes"
                data-type="Sunergy Loan"
                data-amount="₱120,000"
                data-status="Rejected"
                data-date="2024-05-10"
                data-id="1003"
                data-step1='{"Full Name":"Pedro Reyes","Birthday":"1985-09-09","Gender":"Male","Civil Status":"Single"}'
                data-step2='{"Address":"789 Mabini St, Makati","Contact":"09192223333","Email":"pedro@email.com"}'
                data-step3='{"Employer":"Sunergy PH","Position":"Technician","Monthly Income":"₱25,000"}'
                data-step4='{"Loan Purpose":"Solar Panel","Collateral":"House"}'
              >View Details</button></td>
            </tr>
          <tr>
              <td>1004</td>
              <td>Ana Cruz</td>
              <td>Health Loan</td>
              <td>₱30,000</td>
              <td><span class="bg-green-200 text-green-800 px-2 py-1 rounded">Approved</span></td>
              <td>2024-04-15</td>
              <td><button class="text-green-600 hover:underline view-loan-btn"
                data-applicant="Ana Cruz"
                data-type="Health Loan"
                data-amount="₱30,000"
                data-status="Approved"
                data-date="2024-04-15"
                data-id="1004"
                data-step1='{"Full Name":"Ana Cruz","Birthday":"1992-02-09", "Gender":"Female","Civil Status":"Single"}'
                data-step2='{"Address":"123 Jones Ave, Manila","Contact":"09212345678","Email":"ana@gmail.com"}'
                data-step3='{"Employer":"HealthPlus","Position":"Nurse","Monthly Income":"₱28,000"}'
                data-step4='{"Loan Purpose":"Medical Expenses","Collateral":"None"}'
              >View Details</button></td>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- ✅ DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>

  <script>
    $(document).ready(function () {
      // Setup - add a text input or select to each header for filtering
      $('#loanTable thead tr').clone(true).appendTo('#loanTable thead');
      $('#loanTable thead tr:eq(1) th').each(function (i) {
        if (i === 2 || i === 4) { // Type or Status column
          var select = $('<select><option value="">All</option></select>')
            .appendTo($(this).empty())
            .on('change', function () {
              var val = $.fn.dataTable.util.escapeRegex($(this).val());
              table.column(i).search(val ? '^' + val + '$' : '', true, false).draw();
            });

          $('#loanTable tbody tr').each(function () {
            var cellText = $('td', this).eq(i).text().trim();
            if (select.find('option[value="' + cellText + '"]').length === 0) {
              select.append('<option value="' + cellText + '">' + cellText + '</option>');
            }
          });
        } else {
          $(this).html('');
        }
      });

      const table = $('#loanTable').DataTable({
        responsive: true,
        orderCellsTop: true,
        fixedHeader: true
      });
    });

    function renderStep(title, data) {
      let html = `<h4 style="margin:10px 0 5px 0;font-weight:bold;">${title}</h4><ul style="margin:0 0 10px 0;padding-left:18px;">`;
      for (const key in data) {
        html += `<li><strong>${key}:</strong> ${data[key]}</li>`;
      }
      html += '</ul>';
      return html;
    }

    document.querySelectorAll('.view-loan-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        const step1 = JSON.parse(this.dataset.step1 || '{}');
        const step2 = JSON.parse(this.dataset.step2 || '{}');
        const step3 = JSON.parse(this.dataset.step3 || '{}');
        const step4 = JSON.parse(this.dataset.step4 || '{}');

        Swal.fire({
          title: 'Loan Application Details',
          html: `
            <div class="text-left" style="max-height:400px;overflow:auto;">
              ${renderStep('Step 1: Personal Information', step1)}
              ${renderStep('Step 2: Contact Information', step2)}
              ${renderStep('Step 3: Employment Information', step3)}
              ${renderStep('Step 4: Loan Details', step4)}
            </div>
          `,
          showDenyButton: true,
          showCancelButton: true,
          confirmButtonText: 'Approve',
          denyButtonText: 'Reject',
          cancelButtonText: 'Close'
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire('Approved!', '', 'success');
          } else if (result.isDenied) {
            Swal.fire('Rejected!', '', 'error');
          }
        });
      });
    });
  </script>
</body>
</html>
