<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./output.css" rel="stylesheet">
    <link rel="icon" type="image/png"
      href="path/images/logocoop-removebg-preview 2.png">
    <title>Greater Bulacan Livelihood Development Cooperative</title>
  </head>
  <body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div
      class="bg-white shadow-lg rounded-2xl flex max-w-5xl w-full overflow-hidden">

      <!-- Left Column -->
      <div class="bg-gray-200 p-8 w-1/2">
        <h2 class="text-3xl font-bold mb-6 text-center">WELCOME TO</h2>
        <img
          src="path/images/482445912_1229903975417783_6143904361897729543_n-Picsart-AiImageEnhancer 1.png"
          alt="GBLDC Logo" class="w-full mb-6">
        <p class="text-sm text-gray-700 mb-4">
          We are the Greater Bulacan Livelihood Development Cooperative
          (GBLDC)â€”a community-driven cooperative dedicated to empowering
          individuals and businesses through financial solutions, livelihood
          programs, and cooperative services.
        </p>
        <p class="text-sm text-gray-700 mb-6">
          Join us and experience a secure, innovative, and member-focused
          financial system designed to help you grow and achieve financial
          stability.
        </p>
        <p class="italic text-sm text-gray-600">
          Sign up today and be part of our growing cooperative family!
        </p>
      </div>

      <!-- Right Column -->
      <div class="p-8 w-1/2">
        <div class="flex justify-center mb-6">
          <img src="path/images/logocoop-removebg-preview 2.png" alt="Logo Icon"
            class="w-24 h-24 object-contain">
        </div>
        <p  id="fb-success-msg" class="text-center text-sm font-semibold mb-4 text-teal-800 bg-green-300 rounded-md p-2 w-80" hidden>
          Account created and logged in with Facebook!
        </p>
        <form method="POST" action="user-landingpage.php" class="space-y-4"
          autocomplete="off" novalidate>
          <div>
            <label class="block text-sm font-medium text-gray-700"
              for="email">Email</label>
            <input type="email" name="email" id="email" required
              class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 peer"
              placeholder="Enter your Email"
              pattern="^[^\s@]+@[^\s@]+\.[^\s@]+$">
            <p
              class="mt-1 text-xs text-red-600 invisible peer-invalid:visible hidden">Please
              enter a valid email address.</p>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700"
              for="password">Password</label>
            <input type="password" name="password" id="password" required
              minlength="6"
              class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 peer"
              placeholder="Enter your password">
            <p
              class="mt-1 text-xs text-red-600 invisible peer-invalid:visible peer-[min-length='6']:invisible hidden">
              Password must be at least 6 characters.
            </p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              for="confirm_password">Confirm
              Password</label>
            <input type="password" name="confirm_password" id="confirm_password"
              required minlength="6"
              class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 peer"
              placeholder="Enter your confirm password"
              oninput="this.setCustomValidity(this.value !== document.getElementById('password').value ? 'Passwords do not match.' : '')">
            <p
              class="mt-1 text-xs text-red-600 invisible peer-invalid:visible hidden">Passwords
              do not match.</p>
          </div>
          <!-- OTP Section: Hidden by default, shown after sending OTP -->
          <div id="otp-section" class="hidden">
            <label class="block text-sm font-medium text-gray-700"
              for="otp">4-Digit
              OTP</label>
            <input type="text" name="otp" id="otp" required pattern="\d{4}"
              maxlength="4"
              class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-green-500 peer"
              placeholder="Enter 4-digit OTP">
            <p
              class="mt-1 text-xs text-red-600 invisible peer-invalid:visible">OTP
              must be a 4-digit number.</p>
            <div id="otp-timer" class="text-xs text-gray-500 mt-2"></div>
          </div>
          <div>
            <div class="flex justify-end mb-4">
              <button type="button" id="send-otp-btn" required
                class="text-black py-2 rounded-md text-sm font-normal">
                Click to send OTP
              </button>
            </div>
            <div class="flex justify-center mb-2" id="captcha-container">
              <div class="h-captcha"
                data-sitekey="441cb5b6-238c-41fe-972c-6ed6db4cc3c4"></div>
            </div>
            <script src="https://hcaptcha.com/1/api.js" async defer></script>
          </div>
          <div class="text-center text-sm text-gray-500 mt-2">or Signup
            with</div>
          <div class="flex justify-center space-x-4">
            <button type="button"
              class="flex items-center px-4 py-2  rounded-md hover:bg-gray-100">
              <img src="path/images/google.png" class="mr-2 w-8 h-8"
                alt="Google Icon">
            </button>
            <button type="button"
              class="flex items-center px-4 py-2 rounded-md hover:bg-gray-100"
              onclick="facebookLogin()">
              <img src="path/images/facebook.png" class="mr-2 w-8 h-8"
                alt="Facebook Icon">
            </button>
          </div>
          <button type="submit"
            class="w-72 mt-4 mx-20 bg-black text-white py-2 rounded-md hover:bg-gray-800 font-semibold">
            CREATE ACCOUNT
          </button>
          <p class="text-sm text-center mt-2 text-gray-700">
            Already have an account? <a href="landingpage.html"
              class="text-green-600 font-medium">Login</a>
          </p>
        </form>
      </div>
    </div>
    <script>
      const sendOtpBtn = document.getElementById('send-otp-btn');
      const otpSection = document.getElementById('otp-section');
      const otpTimer = document.getElementById('otp-timer');
      const emailInput = document.querySelector("input[name='email']");
      const passwordInput = document.querySelector("input[name='password']");
      const confirmPasswordInput = document.querySelector("input[name='confirm_password']");
      const otpInput = document.querySelector("input[name='otp']");
      const form = document.querySelector('form');
      let timerInterval;
      let timerRunning = false;

      // Utility validation functions
      function validateEmail(email) {
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      }
      function validatePassword(password) {
        return password.length >= 6;
      }
      function validateConfirmPassword(password, confirmPassword) {
        return password === confirmPassword;
      }
      function validateOtp(otp) {
        return /^\d{4}$/.test(otp);
      }

      function showCustomAlert(message, color = '#22c55e') {
        document.querySelectorAll('.custom-alert-overlay, .custom-alert-box').forEach(el => el.remove());
        const overlay = document.createElement('div');
        overlay.className = 'custom-alert-overlay';
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100vw';
        overlay.style.height = '100vh';
        overlay.style.background = 'rgba(0,0,0,0.3)';
        overlay.style.zIndex = '9998';
        const alertBox = document.createElement('div');
        alertBox.className = 'custom-alert-box';
        alertBox.textContent = message;
        alertBox.style.position = 'fixed';
        alertBox.style.top = '50%';
        alertBox.style.left = '50%';
        alertBox.style.transform = 'translate(-50%, -50%)';
        alertBox.style.background = color;
        alertBox.style.color = '#fff';
        alertBox.style.padding = '16px 32px';
        alertBox.style.borderRadius = '8px';
        alertBox.style.boxShadow = '0 2px 8px rgba(0,0,0,0.15)';
        alertBox.style.fontSize = '1rem';
        alertBox.style.zIndex = '9999';
        document.body.appendChild(overlay);
        document.body.appendChild(alertBox);
        setTimeout(() => {
          alertBox.remove();
          overlay.remove();
        }, 2500);
      }

      function startOtpTimer(duration) {
        let timeLeft = duration;
        otpTimer.textContent = `Resend OTP in ${timeLeft}s`;
        sendOtpBtn.disabled = true;
        sendOtpBtn.classList.add('opacity-50', 'cursor-not-allowed');
        timerRunning = true;
        timerInterval = setInterval(() => {
          timeLeft--;
          if (timeLeft > 0) {
            otpTimer.textContent = `Resend OTP in ${timeLeft}s`;
          } else {
            clearInterval(timerInterval);
            otpTimer.textContent = '';
            sendOtpBtn.disabled = false;
            sendOtpBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            sendOtpBtn.textContent = 'Resend OTP';
            timerRunning = false;
          }
        }, 1000);
      }

      function sendOtp() {
        const email = emailInput.value.trim();
        if (!email) {
          showCustomAlert("Please enter your email first!", "#ef4444");
          emailInput.focus();
          return;
        }
        sendOtpBtn.textContent = 'Sending...';
        sendOtpBtn.disabled = true;
        sendOtpBtn.classList.add('opacity-50', 'cursor-not-allowed');
        fetch("send_otp.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: `email=${encodeURIComponent(email)}`
        })
        .then(response => response.text())
        .then(data => {
          otpSection.classList.remove('hidden');
          showCustomAlert(data);
          sendOtpBtn.textContent = 'Resend OTP';
          startOtpTimer(30);
        })
        .catch(error => {
          showCustomAlert("Failed to send OTP. Please try again.", "#ef4444");
          sendOtpBtn.textContent = 'Click to send OTP';
          sendOtpBtn.disabled = false;
          sendOtpBtn.classList.remove('opacity-50', 'cursor-not-allowed');
          console.error("Error:", error);
        });
      }

      sendOtpBtn.addEventListener('click', function() {
        if (!timerRunning) {
          sendOtp();
        }
      });

      // Real-time validation for required fields
      function showFieldError(input, message) {
        let error = input.parentElement.querySelector('.realtime-error');
        if (!error) {
          error = document.createElement('p');
          error.className = 'realtime-error mt-1 text-xs text-red-600';
          input.parentElement.appendChild(error);
        }
        error.textContent = message;
        error.style.display = 'block';
      }

      function hideFieldError(input) {
        let error = input.parentElement.querySelector('.realtime-error');
        if (error) error.style.display = 'none';
      }

      // Email
      emailInput.addEventListener('input', function() {
        if (!emailInput.value.trim()) {
          showFieldError(emailInput, 'Email is required.');
        } else if (!validateEmail(emailInput.value.trim())) {
          showFieldError(emailInput, 'Please enter a valid email address.');
        } else {
          hideFieldError(emailInput);
        }
      });

      // Password
      passwordInput.addEventListener('input', function() {
        if (!passwordInput.value) {
          showFieldError(passwordInput, 'Password is required.');
        } else if (!validatePassword(passwordInput.value)) {
          showFieldError(passwordInput, 'Password must be at least 6 characters.');
        } else {
          hideFieldError(passwordInput);
        }
      });

      // Confirm Password
      confirmPasswordInput.addEventListener('input', function() {
        if (!confirmPasswordInput.value) {
          showFieldError(confirmPasswordInput, 'Please confirm your password.');
        } else if (!validateConfirmPassword(passwordInput.value, confirmPasswordInput.value)) {
          showFieldError(confirmPasswordInput, 'Passwords do not match.');
        } else {
          hideFieldError(confirmPasswordInput);
        }
      });

      // OTP (if visible)
      if (otpInput) {
        otpInput.addEventListener('input', function() {
          if (!otpInput.value) {
            showFieldError(otpInput, 'OTP is required.');
          } else if (!validateOtp(otpInput.value)) {
            showFieldError(otpInput, 'OTP must be a 4-digit number.');
          } else {
            hideFieldError(otpInput);
          }
        });
      }

      // On submit, check all required fields
      form.addEventListener('submit', function(event) {
        let valid = true;
        if (!emailInput.value.trim()) {
          showFieldError(emailInput, 'Email is required.');
          valid = false;
        }
        if (!passwordInput.value) {
          showFieldError(passwordInput, 'Password is required.');
          valid = false;
        }
        if (!confirmPasswordInput.value) {
          showFieldError(confirmPasswordInput, 'Please confirm your password.');
          valid = false;
        }
        if (otpSection && !otpSection.classList.contains('hidden') && otpInput && !otpInput.value) {
          showFieldError(otpInput, 'OTP is required.');
          valid = false;
        }
        if (!valid) {
          event.preventDefault();
          return;
        }
        event.preventDefault();
        const formData = new FormData(form);
        fetch('register.php', {
          method: 'POST',
          body: formData
        })
        .then(response => response.text())
        .then(data => {
          showCustomAlert("ðŸŽ‰ Account successfully created! Welcome to GBLDC.", "#22c55e", "24px 48px", "550px");
          // Add a confetti effect
          const confetti = document.createElement('div');
          confetti.innerHTML = `
            <style>
              @keyframes confetti-fall {
                to { transform: translateY(100vh) rotate(360deg); opacity: 0.7; }
              }
              .confetti-piece {
                position: fixed;
                top: -20px;
                left: 0;
                width: 10px;
                height: 18px;
                opacity: 0.85;
                border-radius: 3px;
                z-index: 10000;
                pointer-events: none;
              }
            </style>
          `;
          for (let i = 0; i < 30; i++) {
            const piece = document.createElement('div');
            piece.className = 'confetti-piece';
            piece.style.background = `hsl(${Math.random()*360},90%,60%)`;
            piece.style.left = `${Math.random()*100}vw`;
            piece.style.animation = `confetti-fall 1.2s cubic-bezier(.6,.4,.4,1) forwards`;
            piece.style.animationDelay = `${Math.random()}s`;
            confetti.appendChild(piece);
          }
          document.body.appendChild(confetti);
          setTimeout(() => confetti.remove(), 1500);
          setTimeout(() => {
            // window.location.href = 'landingpage.html';
            form.reset();
            otpSection.classList.add('hidden');
          }, 1500);
        })
        .catch(error => {
          showCustomAlert("Registration failed. Please try again.", "#ef4444");
          console.error("Error:", error);
        });
      });
    </script>
    <script async defer crossorigin="anonymous"
      src="https://connect.facebook.net/en_US/sdk.js"></script>
    <script>
   window.fbAsyncInit = function() {
    FB.init({
      appId      : '4093222834242920', // Replace with your App ID
      cookie     : true,
      xfbml      : true,
      version    : 'v19.0'
    });
  };

  function facebookLogin() {
    FB.login(function(response) {
      if (response.authResponse) {
        FB.api('/me', {fields: 'name,email'}, function(userInfo) {
          fetch('facebook_register.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `email=${encodeURIComponent(userInfo.email)}&name=${encodeURIComponent(userInfo.name)}`
          })
          .then(res => res.text())
          .then(data => {
            // Show the message below the logo
            const msg = document.getElementById('fb-success-msg');
            if (msg) {
              msg.removeAttribute('hidden');
              msg.style.display = 'flex';
              msg.style.justifyContent = 'center';
              msg.style.alignItems = 'center';
              msg.style.margin = '0 auto';
              setTimeout(() => {
                msg.setAttribute('hidden', '');
                msg.style.display = 'none';
              }, 2500);
            }
            // Optionally, reset the form and hide OTP section if needed
            if (form) {
              form.reset();
              if (otpSection) otpSection.classList.add('hidden');
            }
            // Redirect to landing page or perform any other action
            // window.location.href = 'landingpage.html';
          })
          .catch(error => {
            showCustomAlert("Facebook registration failed. Please try again.", "#ef4444");
            console.error("Error:", error);
          });
        });
      }
    });
  }
</script>
<script src="../src/register.php"></script>
  </body>
</html>